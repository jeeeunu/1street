<!DOCTYPE html>
<html lang="ko">
  <!-- include : head -->
  <%- include('includes/head') %>

  <body>
    <!-- include : top-button -->
    <%- include('includes/top-button') %>

    <!-- include : preloder -->
    <%- include('includes/preloder') %>

    <!-- include : header -->
    <%- include('includes/header') %>

    <!-- include : hero-normal -->
    <%- include('includes/hero') %>

    <!-- 내정보 (일반) -->
    <main class="mypage container create-review">
      <h2 class="title">마이페이지</h2>
      <div class="row">
        <aside class="col-lg-3">
          <div class="proflie-info-container">
            <div class="primary-img-wrap">
              <img src="<%- user.profile_image %> " alt="" />
            </div>
            <div class="text-wrap">
              <div class="name-wrap">
                <span><%- authUser.user_name %> 님</span>
                <a href="/my-page-user-edit"> >내 정보 수정</a>
              </div>
              <div>
                <span>충전금액: </span>
                <span><%- user.point %>원</span>
              </div>
              <div>
                <span>포인트: </span>
                <span><%- user.point %>원</span>
              </div>
              <div>
                <span>잔여 쿠폰: </span>
                <span>2개</span>
              </div>
            </div>
            <hr />
            <div class="provider-text">
              <% if (user.provider === "google") { %>
              <img
                src="https://cdn-icons-png.flaticon.com/512/2991/2991148.png"
                style="width: 15px; height: 15px; margin-right: 7px"
                alt=""
              />구글 로그인 <% } %>
            </div>
            <button
              type="button"
              class="gray-text btn-user-delete"
              onclick="deleteUser()"
            >
              회원 탈퇴
            </button>
          </div>
        </aside>

        <section class="col-lg-9">
          <section class="list-container">
            <div class="input-container">
              <div class="content-box">
                <h3 style="margin-bottom: 30px">*리뷰 작성</h3>
                <div class="input-box">
                  <label class="label required">상품명: </label>
                  <input type="text" id="productName" name="" required="" />
                </div>
                <div class="input-box">
                  <label class="label required">판매가: </label>
                  <input type="number" id="productPrice" name="" required="" />
                </div>
                <div class="basic-input-box">
                  <div class="edit-img-container d-flex">
                    <label class="label required">썸네일: </label>
                    <div class="edit-img-container">
                      <div class="edit-img-wrap"></div>
                      <input
                        type="file"
                        class="profile-input"
                        style="display: block; margin-top: 5px"
                        onchange="setThumbnail(event)"
                      />
                    </div>
                    <div class="edit-img-container">
                      <div class="edit-img-wrap"></div>
                      <input
                        type="file"
                        class="profile-input"
                        style="display: block; margin-top: 5px"
                        onchange="setThumbnail(event)"
                      />
                    </div>
                    <div class="edit-img-container">
                      <div class="edit-img-wrap"></div>
                      <input
                        type="file"
                        class="profile-input"
                        style="display: block; margin-top: 5px"
                        onchange="setThumbnail(event)"
                      />
                    </div>
                  </div>
                </div>
              </div>
              <button
                type="button"
                class="btn-primary-m"
                onclick="createProduct()"
              >
                상품등록 하기
              </button>
            </div>
          </section>
        </section>
      </div>
    </main>

    <!-- include : footer -->
    <%- include('includes/footer') %>

    <script>
      //-- 유저 탈퇴 api --//
      const deleteUser = async () => {
        const firstConfirm = window.confirm('회원 탈퇴 하시겠습니까?');

        if (firstConfirm) {
          const secondConfirm = window.confirm(
            '다시 되돌릴 수 없습니다. 정말 탈퇴하시겠습니까?',
          );

          if (secondConfirm) {
            try {
              const response = await fetch('users', {
                method: 'DELETE',
              });

              const data = await response.json();
              console.log(data);

              if (response.ok) {
                alert(data.message);
                window.location.href = '/';
              } else {
                alert(data.message);
                console.error('회원 탈퇴중 오류가 발생했습니다.');
                window.location.href = '/';
              }
            } catch (error) {
              console.error('Error:', error);
              alert('오류가 발생했습니다.');
            }
          }
        }
      };
    </script>
  </body>
</html>
