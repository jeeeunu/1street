<!DOCTYPE html>
<html lang="ko">
  <!-- include : head -->
  <%- include('includes/head') %>
  <body>
    <!-- include : preloder -->
    <%- include('includes/preloder') %>

    <!-- include : header -->
    <%- include('includes/header') %>

    <!-- Admin Qna Page Section Begin -->
    <section class="admin-qna-page spad">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <div class="admin-qna__title">
              <h2>문의사항</h2>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-12">
            <div class="admin-qna__table">
              <table>
                <thead>
                  <tr>
                    <th>날짜</th>
                    <th>상품정보</th>
                    <th>문의 내용</th>
                    <th>확인/신청</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>2023-08-30</td>
                    <td>상품 A</td>
                    <td>상품 A에 대한 문의 내용입니다.</td>
                    <td>
                      <a href="/admin/answer?id=1" class="admin-qna__answer-btn"
                        >답변하기</a
                      >
                    </td>
                  </tr>
                  <tr>
                    <td>2023-08-29</td>
                    <td>상품 B</td>
                    <td>상품 B에 대한 문의 내용입니다.</td>
                    <td>
                      <a href="/admin/answer?id=2" class="admin-qna__answer-btn"
                        >답변하기</a
                      >
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Admin Qna Page Section End -->

    <!-- include : footer -->
    <%- include('includes/footer') %>

    <!-- JavaScript 처리 -->
    <script>
      const qnaEl = document.querySelector('.qna');

      const getQnaData = async () => {
        // 서버에서 QNA 목록을 가져와서 화면에 표시하는 함수
        const response = await fetch(`/api/qnas/${qnaId}`); // QNA를 가져오는 API 엔드포인트
        const { data } = await response.json();
        // console.log(data);
        if (data.length === 0) return;
        // data 배열을 순회하며 QNA 정보를 화면에 표시하는 HTML 생성
        const temp = data.map((qna) => {
          // 상품 정보 항목을 어떻게 끌어와야 되는건지? 일단 써두긴 했지만
          return `
                <li class="qna-container" data-id=${qna.qnaId}>
                    <p class="qna-date">날짜 : ${new Date(
                      qna.createdAt,
                    ).toLocaleString()}</p>
                    <p class="qna-productName">상품정보 : ${qna.productName}</p>
                    <p class="qna-content">문의 내용 : ${qna.content}</p>
                    <button class="admin-qna__answer-btn">답변하기</button>
                </li>
                `;
        });

        const joinTemp = temp.join('');
        qnaEl.innerHTML = joinTemp;
      };

      getQnaData(); // 초기 데이터 로드

      document.addEventListener('click', (event) => {
        const target = event.target;

        if (target.classList.contains('admin-qna__answer-btn')) {
          const qnaId = target
            .closest('.qna-container')
            .getAttribute('data-id');
          window.location.href = `/admin/answer?id=${qnaId}`; // 구체적인 주소 파악해서 수정
        }
      });
    </script>
  </body>
</html>
